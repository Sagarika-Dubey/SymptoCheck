<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Medical Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #667eea;
        }

        .logo i {
            font-size: 2rem;
            animation: pulse 2s infinite;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: #f8f9fa;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Main Content */
        .main {
            padding: 2rem 0;
        }

        /* Add smooth transitions */
        .tab-content {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            display: none;
        }

        .tab-content.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        /* Chat Styles */
        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .chat-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 10px;
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
        }

        .user-message .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message .message-content {
            background: white;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        .audio-container {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .audio-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .audio-btn.playing {
            background: #dc3545;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            max-width: 70%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .chat-input-container {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .chat-input {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input input:focus {
            border-color: #667eea;
        }

        .input-controls {
            display: flex;
            gap: 10px;
        }

        .voice-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: #218838;
            transform: scale(1.1);
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1s infinite;
        }

        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .quick-symptoms {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .quick-symptoms span {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .quick-btn {
            padding: 6px 12px;
            border: 1px solid #667eea;
            border-radius: 15px;
            background: transparent;
            color: #667eea;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }

        /* Voice status indicator */
        .voice-status {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 10px;
            color: #856404;
            font-size: 0.9rem;
            text-align: center;
        }

        .voice-status.show {
            display: block;
        }

        /* Form Styles */
        .diagnosis-container, .prescription-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .diagnosis-header, .prescription-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8f9fa;
        }

        .diagnosis-header h2, .prescription-header h2 {
            color: #667eea;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .symptoms-input, .history-input {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .symptoms-input input, .history-input input {
            flex: 1;
        }

        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .add-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .symptoms-list, .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .symptom-tag, .history-tag {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-tag {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .results-section, .prescription-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .hidden {
            display: none;
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            color: #856404;
        }

        .disclaimer i {
            color: #f39c12;
            margin-right: 8px;
        }

        /* Loading Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header .container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav {
                width: 100%;
                justify-content: space-between;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            .wellness-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chat-container {
                margin: 0 10px;
            }

            .chat-messages {
                height: calc(100vh - 300px);
            }

            .message-content {
                max-width: 90%;
            }
        }

        /* Add loading animation */
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-animation.active {
            opacity: 1;
            visibility: visible;
        }

        /* Improve form interactions */
        .form-control:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .btn {
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .btn:active::after {
            width: 200px;
            height: 200px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .wellness-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .wellness-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .wellness-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .mood-tracker {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .mood-scale {
            text-align: center;
            margin-bottom: 1rem;
        }

        .mood-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .mood-btn {
            font-size: 2rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .mood-btn:hover {
            transform: scale(1.2);
        }

        .mood-btn.selected {
            background: #667eea;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .selected-mood {
            margin-top: 1rem;
            padding: 0.5rem;
            background: #e6f3ff;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            color: #2d3748;
        }

        .mood-notes {
            margin-top: 1rem;
        }

        .mood-notes textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 1rem;
            min-height: 100px;
            resize: vertical;
        }

        .mood-history {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .mood-history h4 {
            color: #4a5568;
            margin-bottom: 1rem;
        }

        .mood-entries {
            max-height: 300px;
            overflow-y: auto;
        }

        .mood-entry {
            background: #f7fafc;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .mood-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .mood-entry-mood {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .mood-entry-date {
            font-size: 0.8rem;
            color: #666;
        }

        .mood-entry-notes {
            color: #4a5568;
            font-style: italic;
        }

        .no-entries {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }

        .card-title {
            font-size: 1.5rem;
            color: #4a5568;
            margin: 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .response-area {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: none;
        }

        .response-text {
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .audio-player {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-weight: 600;
        }

        .loading::after {
            content: "...";
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }

        .error-message {
            color: #e53e3e;
            background: #fed7d7;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: #38a169;
            background: #c6f6d5;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .wellness-tip {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .file-input-button:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .wellness-check-sliders {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .slider-group {
            text-align: center;
        }

        .slider {
            width: 100%;
            margin: 10px 0;
        }

        .slider-value {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .wellness-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .wellness-card {
                padding: 20px;
            }

            .mood-buttons {
                gap: 0.5rem;
            }

            .mood-btn {
                font-size: 1.5rem;
            }
        }

        .audio-note {
            background-color: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        .audio-note i {
            color: #667eea;
            margin-right: 5px;
        }

        .mood-entry-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .delete-entry-btn {
            background: none;
            border: none;
            color: #e53e3e;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .delete-entry-btn:hover {
            background: #fed7d7;
            transform: scale(1.1);
        }

        .delete-entry-btn i {
            font-size: 0.9rem;
        }

        /* Voice Button Styles */
        .voice-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background: #218838;
            transform: scale(1.1);
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1s infinite;
        }

        /* Voice Status Styles */
        .voice-status {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 10px;
            color: #856404;
            font-size: 0.9rem;
            text-align: center;
        }

        .voice-status.show {
            display: block;
        }

        /* Audio Player Styles */
        .audio-container {
            margin-top: 10px;
            display: flex;
            justify-content: flex-start;
        }

        .audio-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .audio-btn.playing {
            background: #dc3545;
        }

        .audio-btn i {
            font-size: 1rem;
        }

        .volume-slider {
            width: 100px;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .audio-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
            gap: 10px;
        }
        
        .audio-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .audio-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .audio-btn.playing {
            background: #dc3545;
        }
    </style>
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            console.error("Global JS Error:", message, "at", source + ":" + lineno + ":" + colno);
            return true; // prevent default handling (like reload)
        };
    </script>
    <script src="script.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <h1>AI Medical Assistant</h1>
            </div>
            <nav class="nav">
                <button class="nav-btn active" data-tab="chatbot">
                    <i class="fas fa-robot"></i> AI Chatbot
                </button>
                <button class="nav-btn" data-tab="diagnosis">
                    <i class="fas fa-stethoscope"></i> Quick Check
                </button>
                <button class="nav-btn" data-tab="prescription">
                    <i class="fas fa-prescription-bottle"></i> Mental Health
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- AI Chatbot Tab -->
            <!-- AI Chatbot Tab -->
            <section id="chatbot-tab" class="tab-content active">
                <div class="chat-container">
                    <div class="chat-header">
                        <h2><i class="fas fa-robot"></i> AI Medical Chatbot</h2>
                        <p>Speak with our AI assistant about your symptoms and health concerns</p>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be populated by JavaScript -->
                    </div>
                    
                    <div class="chat-input-container">
                        <div id="voiceStatus" class="voice-status">
                            <i class="fas fa-microphone"></i> <span id="voiceStatusText">Listening...</span>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Describe your symptoms or ask a health question..." maxlength="500">
                            <div class="input-controls">
                                <button id="voiceButton" class="voice-btn" title="Voice Input">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button id="sendMessage" class="send-btn" title="Send Message">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div class="quick-symptoms">
                            <span>Quick options:</span>
                            <button class="quick-btn" data-symptom="I have a headache and feel tired">Headache</button>
                            <button class="quick-btn" data-symptom="I have chest pain and difficulty breathing">Chest Pain</button>
                            <button class="quick-btn" data-symptom="I have fever and body aches">Fever</button>
                            <button class="quick-btn" data-symptom="I feel dizzy and nauseous">Dizziness</button>
                            <button class="quick-btn" data-symptom="I have stomach pain and indigestion">Stomach Issues</button>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Quick Diagnosis Tab -->
            <section id="diagnosis-tab" class="tab-content">
                <div class="diagnosis-container">
                    <div class="diagnosis-header">
                        <h2><i class="fas fa-stethoscope"></i> Quick Symptom Checker</h2>
                        <p>Get comprehensive analysis of your symptoms</p>
                    </div>
                    
                    <form id="diagnosisForm" class="diagnosis-form">
                        <div class="form-section">
                            <h3>Patient Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="age">Age</label>
                                    <input type="number" id="age" min="1" max="120" placeholder="25">
                                </div>
                                <div class="form-group">
                                    <label for="gender">Gender</label>
                                    <select id="gender">
                                        <option value="">Select</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h3>Current Symptoms</h3>
                            <div class="symptoms-input">
                                <input type="text" id="symptomInput" placeholder="Enter a symptom (e.g., headache, fever, cough)">
                                <button type="button" id="addSymptom" class="add-btn">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="symptomsList" class="symptoms-list"></div>
                        </div>
                        
                        <div class="form-section">
                            <h3>Medical History (Optional)</h3>
                            <div class="history-input">
                                <input type="text" id="historyInput" placeholder="e.g., diabetes, hypertension, allergies">
                                <button type="button" id="addHistory" class="add-btn">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="historyList" class="history-list"></div>
                        </div>
                        
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-search"></i> Analyze Symptoms
                        </button>
                    </form>
                    
                    <div id="diagnosisResults" class="results-section hidden">
                        <h3><i class="fas fa-chart-line"></i> Analysis Results</h3>
                        <div id="resultsContent"></div>
                    </div>
                </div>
            </section>

            <!-- Mental Health Tab -->
            <section id="prescription-tab" class="tab-content">
                <div class="diagnosis-container">
                    <div class="container">
                        <div class="header">
                            <h1 style="color: #764ba2;">🌸 Dr. Serenity</h1>
                            <p>Your compassionate AI wellness coach for mental health, yoga, and holistic wellbeing</p>
                        </div>
                
                        <div class="wellness-grid">
                            <!-- Wellness Chat Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">💬</span>
                                    <h3 class="card-title">Wellness Chat</h3>
                                </div>
                                <form id="chatForm">
                                    <div class="form-group">
                                        <label for="sessionType">Session Type:</label>
                                        <select id="sessionType" class="form-control">
                                            <option value="general">General Wellness</option>
                                            <option value="mental_health">Mental Health Support</option>
                                            <option value="yoga_wellness">Yoga & Mindfulness</option>
                                            <option value="lifestyle_nutrition">Lifestyle & Nutrition</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="messageText">Share what's on your mind:</label>
                                        <textarea id="messageText" class="form-control" rows="4" 
                                                placeholder="Tell me how you're feeling or what you'd like support with..."></textarea>
                                    </div>
                                    <button type="submit" class="btn">Get Wellness Support</button>
                                </form>
                                <div class="loading" id="chatLoading">Generating your wellness response</div>
                                <div class="error-message" id="chatError"></div>
                                <div class="response-area" id="chatResponse">
                                    <div class="response-text" id="chatResponseText"></div>
                                    <div class="audio-note">
                                        <i class="fas fa-headphones"></i> Audio response available
                                    </div>
                                </div>
                            </div>
                
                            <!-- Mood Tracker Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">📊</span>
                                    <h3 class="card-title">Mood Tracker</h3>
                                </div>
                                <div class="mood-tracker">
                                    <div class="mood-scale">
                                        <span>How are you feeling today?</span>
                                        <div class="mood-buttons">
                                            <button class="mood-btn" data-mood="1" data-emoji="😢" data-label="Very Sad">😢</button>
                                            <button class="mood-btn" data-mood="2" data-emoji="😕" data-label="Sad">😕</button>
                                            <button class="mood-btn" data-mood="3" data-emoji="😐" data-label="Neutral">😐</button>
                                            <button class="mood-btn" data-mood="4" data-emoji="🙂" data-label="Happy">🙂</button>
                                            <button class="mood-btn" data-mood="5" data-emoji="😊" data-label="Very Happy">😊</button>
                                        </div>
                                        <div id="selectedMoodDisplay" class="selected-mood" style="display: none;">
                                            <span>Selected mood: <span id="selectedMoodText"></span></span>
                                        </div>
                                    </div>
                                    <div class="mood-notes">
                                        <textarea id="moodNotes" placeholder="Add notes about your mood, thoughts, or feelings..."></textarea>
                                        <button id="saveMood" class="btn" disabled>Save Entry</button>
                                    </div>
                                </div>
                                <div class="success-message" id="moodSuccess"></div>
                                <div id="moodHistory" class="mood-history">
                                    <h4>Recent Entries</h4>
                                    <div id="moodEntries" class="mood-entries">
                                        <div class="no-entries">No mood entries yet. Start tracking your mood above!</div>
                                    </div>
                                </div>
                            </div>
                
                            <!-- Yoga Sequence Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">🧘‍♀️</span>
                                    <h3 class="card-title">Yoga Sequence</h3>
                                </div>
                                <form id="yogaForm">
                                    <div class="form-group">
                                        <label for="yogaNeed">What do you need?</label>
                                        <select id="yogaNeed" class="form-control">
                                            <option value="stress">Stress Relief</option>
                                            <option value="energy">Energy Boost</option>
                                            <option value="sleep">Better Sleep</option>
                                            <option value="flexibility">Flexibility</option>
                                            <option value="general">General Practice</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="yogaDuration">Duration (minutes):</label>
                                        <input type="number" id="yogaDuration" class="form-control" value="15" min="5" max="60">
                                    </div>
                                    <div class="form-group">
                                        <label for="yogaLevel">Experience Level:</label>
                                        <select id="yogaLevel" class="form-control">
                                            <option value="beginner">Beginner</option>
                                            <option value="intermediate">Intermediate</option>
                                            <option value="advanced">Advanced</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn">Create Yoga Sequence</button>
                                </form>
                                <div class="loading" id="yogaLoading">Creating your personalized yoga sequence</div>
                                <div class="error-message" id="yogaError"></div>
                                <div class="response-area" id="yogaResponse">
                                    <div class="response-text" id="yogaResponseText"></div>
                                    <div class="audio-note">
                                        <i class="fas fa-headphones"></i> Audio sequence available
                                    </div>
                                </div>
                            </div>
                
                            <!-- Guided Meditation Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">🧘</span>
                                    <h3 class="card-title">Guided Meditation</h3>
                                </div>
                                <form id="meditationForm">
                                    <div class="form-group">
                                        <label for="meditationType">Meditation Type:</label>
                                        <select id="meditationType" class="form-control">
                                            <option value="relaxation">Relaxation</option>
                                            <option value="anxiety">Anxiety Relief</option>
                                            <option value="sleep">Sleep Preparation</option>
                                            <option value="focus">Focus & Clarity</option>
                                            <option value="loving_kindness">Loving Kindness</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="meditationDuration">Duration (minutes):</label>
                                        <input type="number" id="meditationDuration" class="form-control" value="10" min="3" max="30">
                                    </div>
                                    <button type="submit" class="btn">Start Guided Meditation</button>
                                </form>
                                <div class="loading" id="meditationLoading">Preparing your guided meditation</div>
                                <div class="error-message" id="meditationError"></div>
                                <div class="response-area" id="meditationResponse">
                                    <div class="response-text" id="meditationResponseText"></div>
                                    <div class="audio-note">
                                        <i class="fas fa-headphones"></i> Audio meditation available
                                    </div>
                                </div>
                            </div>
                
                            <!-- Nutrition Plan Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">🥗</span>
                                    <h3 class="card-title">Nutrition & Lifestyle</h3>
                                </div>
                                <form id="nutritionForm">
                                    <div class="form-group">
                                        <label for="nutritionGoal">Wellness Goal:</label>
                                        <select id="nutritionGoal" class="form-control">
                                            <option value="mental_clarity">Mental Clarity</option>
                                            <option value="energy">Energy Boost</option>
                                            <option value="stress_relief">Stress Relief</option>
                                            <option value="general_wellness">General Wellness</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="dietaryPrefs">Dietary Preferences (optional):</label>
                                        <input type="text" id="dietaryPrefs" class="form-control" 
                                               placeholder="e.g., vegetarian, vegan, gluten-free">
                                    </div>
                                    <button type="submit" class="btn">Get Nutrition Plan</button>
                                </form>
                                <div class="loading" id="nutritionLoading">Creating your personalized nutrition plan</div>
                                <div class="error-message" id="nutritionError"></div>
                                <div class="response-area" id="nutritionResponse">
                                    <div class="response-text" id="nutritionResponseText"></div>
                                </div>
                            </div>
                
                            <!-- Wellness Check Card -->
                            <div class="wellness-card">
                                <div class="card-header">
                                    <span class="card-icon">💚</span>
                                    <h3 class="card-title">Wellness Check-In</h3>
                                </div>
                                <form id="wellnessCheckForm">
                                    <div class="wellness-check-sliders">
                                        <div class="slider-group">
                                            <label>Mood Level</label>
                                            <input type="range" id="moodSlider" class="slider" min="1" max="10" value="5">
                                            <div class="slider-value" id="moodValue">5/10</div>
                                        </div>
                                        <div class="slider-group">
                                            <label>Energy Level</label>
                                            <input type="range" id="energySlider" class="slider" min="1" max="10" value="5">
                                            <div class="slider-value" id="energyValue">5/10</div>
                                        </div>
                                        <div class="slider-group">
                                            <label>Stress Level</label>
                                            <input type="range" id="stressSlider" class="slider" min="1" max="10" value="5">
                                            <div class="slider-value" id="stressValue">5/10</div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn">Get Personalized Support</button>
                                </form>
                                <div class="loading" id="wellnessLoading">Analyzing your wellness check-in</div>
                                <div class="error-message" id="wellnessError"></div>
                                <div class="response-area" id="wellnessResponse">
                                    <div class="response-text" id="wellnessResponseText"></div>
                                    <div class="response-text" id="wellnessRecommendation"></div>
                                </div>
                            </div>
                        </div>
                
                        <div class="wellness-tip" id="dailyTip">
                            <h3>💡 Daily Wellness Tip</h3>
                            <p>Loading your daily inspiration...</p>
                        </div>
                    </div>
                </div>                    
            </section>

            <!-- Loading Modal -->
            <div id="loadingModal" class="hidden">
                <div class="modal-content">
                    <div class="loader"></div>
                    <p>Analyzing your information...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Medical Chatbot Frontend JavaScript
        class MedicalChatbot {
            constructor() {
                this.symptoms = [];
                this.medicalHistory = [];
                this.currentAudio = null;
                this.apiBaseUrl = 'http://127.0.0.1:5000';
                this.isRecording = false;
                this.recognition = null;
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeTabs();
                this.addWelcomeMessage();
                this.initializeVoiceRecognition();
            }

            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.target.closest('.nav-btn').dataset.tab;
                        this.switchTab(tabName);
                    });
                });

                // Chat functionality
                const sendBtn = document.getElementById('sendMessage');
                const chatInput = document.getElementById('chatInput');
                const voiceBtn = document.getElementById('voiceButton');
                
                if (sendBtn) sendBtn.addEventListener('click', () => this.sendMessage());
                if (chatInput) {
                    chatInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.sendMessage();
                    });
                }
                if (voiceBtn) voiceBtn.addEventListener('click', () => this.toggleVoiceRecording());

                // Quick symptom buttons
                document.querySelectorAll('.quick-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const symptom = e.target.dataset.symptom;
                        document.getElementById('chatInput').value = symptom;
                        this.sendMessage();
                    });
                });

                // Diagnosis form
                const diagnosisForm = document.getElementById('diagnosisForm');
                if (diagnosisForm) {
                    diagnosisForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.analyzeSymptoms();
                    });
                }

                // Add symptom functionality
                const addSymptomBtn = document.getElementById('addSymptom');
                const symptomInput = document.getElementById('symptomInput');
                
                if (addSymptomBtn) addSymptomBtn.addEventListener('click', () => this.addSymptom());
                if (symptomInput) {
                    symptomInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.addSymptom();
                        }
                    });
                }

                // Add medical history functionality
                const addHistoryBtn = document.getElementById('addHistory');
                const historyInput = document.getElementById('historyInput');
                
                if (addHistoryBtn) addHistoryBtn.addEventListener('click', () => this.addMedicalHistory());
                if (historyInput) {
                    historyInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.addMedicalHistory();
                        }
                    });
                }

                // Prescription form
                const prescriptionForm = document.getElementById('prescriptionForm');
                if (prescriptionForm) {
                    prescriptionForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.generateRecommendations();
                    });
                }
            }

            initializeVoiceRecognition() {
                // Check for speech recognition support
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        this.isRecording = true;
                        this.updateVoiceUI(true);
                        this.showVoiceStatus('Listening... Speak now');
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('chatInput').value = transcript;
                        this.hideVoiceStatus();
                        this.sendMessage();
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.isRecording = false;
                        this.updateVoiceUI(false);
                        this.showVoiceStatus('Voice recognition failed. Please try again.');
                        setTimeout(() => this.hideVoiceStatus(), 3000);
                    };

                    this.recognition.onend = () => {
                        this.isRecording = false;
                        this.updateVoiceUI(false);
                        this.hideVoiceStatus();
                    };
                } else {
                    console.warn('Speech recognition not supported in this browser');
                    // Hide voice button if not supported
                    const voiceBtn = document.getElementById('voiceButton');
                    if (voiceBtn) {
                        voiceBtn.style.display = 'none';
                    }
                }
            }

            initializeTabs() {
                // Initialize first tab as active
                this.switchTab('chatbot');
            }

            switchTab(tabName) {
                // Remove active class from all tabs and buttons
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Add active class to selected tab and button
                const targetTab = document.getElementById(`${tabName}-tab`);
                const targetBtn = document.querySelector(`[data-tab="${tabName}"]`);
                
                if (targetTab) targetTab.classList.add('active');
                if (targetBtn) targetBtn.classList.add('active');
            }

            addWelcomeMessage() {
                const welcomeMessage = `Hello! I'm your AI Medical Assistant. I can help you with:
                
• General health questions and symptoms
• Wellness advice and tips
• Basic medical information
• When to seek professional care

Please remember: I provide general information only. For serious concerns, emergencies, or specific medical advice, always consult a healthcare professional.

How can I help you today?`;
                
                this.addMessage(welcomeMessage, 'bot');
            }

            toggleVoiceRecording() {
                if (!this.recognition) {
                    this.showVoiceStatus('Voice recognition not supported in this browser');
                    setTimeout(() => this.hideVoiceStatus(), 3000);
                    return;
                }

                if (this.isRecording) {
                    this.recognition.stop();
                } else {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        console.error('Failed to start voice recognition:', error);
                        this.showVoiceStatus('Failed to start voice recognition');
                        setTimeout(() => this.hideVoiceStatus(), 3000);
                    }
                }
            }

            updateVoiceUI(isRecording) {
                const voiceBtn = document.getElementById('voiceButton');
                if (voiceBtn) {
                    if (isRecording) {
                        voiceBtn.classList.add('recording');
                        voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                        voiceBtn.title = 'Stop Recording';
                    } else {
                        voiceBtn.classList.remove('recording');
                        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                        voiceBtn.title = 'Voice Input';
                    }
                }
            }

            showVoiceStatus(message) {
                const voiceStatus = document.getElementById('voiceStatus');
                const voiceStatusText = document.getElementById('voiceStatusText');
                if (voiceStatus && voiceStatusText) {
                    voiceStatusText.textContent = message;
                    voiceStatus.classList.add('show');
                }
            }

            hideVoiceStatus() {
                const voiceStatus = document.getElementById('voiceStatus');
                if (voiceStatus) {
                    voiceStatus.classList.remove('show');
                }
            }

            async sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;

                // Add user message to chat
                this.addMessage(message, 'user');
                input.value = '';

                // Show typing indicator
                this.showTypingIndicator();

                try {
                    // Send to backend
                    const response = await fetch(`${this.apiBaseUrl}/medical_bot`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ question: message })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Remove typing indicator
                    this.removeTypingIndicator();
                    
                    // Add bot response with audio
                    this.addMessage(data.response_text, 'bot', data.audio_url);
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    this.removeTypingIndicator();
                    
                    const errorMessage = `I apologize, but I'm having trouble connecting to the server right now. Please try again in a moment.

If the problem persists, please check:
• Your internet connection
• That the backend server is running on port 5000
• Try refreshing the page

For immediate medical concerns, please contact your healthcare provider directly.`;
                    
                    this.addMessage(errorMessage, 'bot');
                }
            }

            addMessage(text, sender, audioUrl = null) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message`;

                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                
                // Format message text with line breaks
                const formattedText = text.replace(/\n/g, '<br>');
                messageContent.innerHTML = `
                    <div>${formattedText}</div>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                `;

                // Add audio player for bot messages
                if (sender === 'bot' && audioUrl) {
                    const audioContainer = document.createElement('div');
                    audioContainer.className = 'audio-container';
                    
                    const audioBtn = document.createElement('button');
                    audioBtn.className = 'audio-btn';
                    audioBtn.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                    
                    audioBtn.addEventListener('click', () => {
                        this.playAudio(audioUrl, audioBtn);
                    });
                    
                    audioContainer.appendChild(audioBtn);
                    messageContent.appendChild(audioContainer);
                }

                messageDiv.appendChild(messageContent);
                messagesContainer.appendChild(messageDiv);

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            showTypingIndicator() {
                const messagesContainer = document.getElementById('chatMessages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bot-message';
                typingDiv.id = 'typing-indicator';

                const typingContent = document.createElement('div');
                typingContent.className = 'typing-indicator';
                typingContent.innerHTML = `
                    <span>AI is thinking</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;

                typingDiv.appendChild(typingContent);
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            removeTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            async playAudio(audioUrl, buttonElement) {
    // If this is the currently playing audio and it's already playing, stop it
    if (this.currentAudio && this.currentAudio.src === audioUrl && !this.currentAudio.paused) {
        this.currentAudio.pause();
        this.currentAudio.currentTime = 0;
        this.currentAudio = null;

        buttonElement.classList.remove('playing');
        buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
        return;
    }

    // Stop any other audio
    if (this.currentAudio) {
        this.currentAudio.pause();
        this.currentAudio.currentTime = 0;

        // Reset all buttons
        document.querySelectorAll('.audio-btn.playing').forEach(btn => {
            btn.classList.remove('playing');
            btn.innerHTML = '<i class="fas fa-play"></i> Play Audio';
        });
    }

    // Create and play new audio
    this.currentAudio = new Audio(audioUrl);
    
    // Set volume to maximum
    this.currentAudio.volume = 1.0;
    
    // Add event listeners for better control
    this.currentAudio.onplay = () => {
        buttonElement.classList.add('playing');
        buttonElement.innerHTML = '<i class="fas fa-stop"></i> Stop Audio';
    };

    this.currentAudio.onpause = () => {
        buttonElement.classList.remove('playing');
        buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
    };

    this.currentAudio.onended = () => {
        buttonElement.classList.remove('playing');
        buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
        this.currentAudio = null;
    };

    this.currentAudio.onerror = (error) => {
        console.error('Audio playback failed:', error);
        buttonElement.classList.remove('playing');
        buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Playback Failed';
        this.currentAudio = null;

        setTimeout(() => {
            buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
        }, 3000);
    };

    try {
        // Play the audio
        const playPromise = this.currentAudio.play();
        
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.error('Audio playback failed:', error);
                buttonElement.classList.remove('playing');
                buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Playback Failed';
                this.currentAudio = null;

                setTimeout(() => {
                    buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                }, 3000);
            });
        }
    } catch (error) {
        console.error('Audio playback failed:', error);
        buttonElement.classList.remove('playing');
        buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Playback Failed';
        this.currentAudio = null;

        setTimeout(() => {
            buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
        }, 3000);
    }
}


            // Diagnosis form methods
            addSymptom() {
                const input = document.getElementById('symptomInput');
                const symptom = input.value.trim();
                
                if (symptom && !this.symptoms.includes(symptom.toLowerCase())) {
                    this.symptoms.push(symptom.toLowerCase());
                    this.updateSymptomsList();
                    input.value = '';
                }
            }

            removeSymptom(symptom) {
                this.symptoms = this.symptoms.filter(s => s !== symptom);
                this.updateSymptomsList();
            }

            updateSymptomsList() {
                const container = document.getElementById('symptomsList');
                container.innerHTML = '';
                
                this.symptoms.forEach(symptom => {
                    const tag = document.createElement('div');
                    tag.className = 'symptom-tag';
                    tag.innerHTML = `
                        ${symptom}
                        <button type="button" class="remove-tag" onclick="chatbot.removeSymptom('${symptom}')">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(tag);
                });
            }

            addMedicalHistory() {
                const input = document.getElementById('historyInput');
                const history = input.value.trim();
                
                if (history && !this.medicalHistory.includes(history.toLowerCase())) {
                    this.medicalHistory.push(history.toLowerCase());
                    this.updateHistoryList();
                    input.value = '';
                }
            }

            removeHistory(history) {
                this.medicalHistory = this.medicalHistory.filter(h => h !== history);
                this.updateHistoryList();
            }

            updateHistoryList() {
                const container = document.getElementById('historyList');
                container.innerHTML = '';
                
                this.medicalHistory.forEach(history => {
                    const tag = document.createElement('div');
                    tag.className = 'history-tag';
                    tag.innerHTML = `
                        ${history}
                        <button type="button" class="remove-tag" onclick="chatbot.removeHistory('${history}')">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(tag);
                });
            }

            async analyzeSymptoms() {
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender').value;
                
                if (!age || !gender || this.symptoms.length === 0) {
                    alert('Please fill in your age, gender, and add at least one symptom.');
                    return;
                }

                this.showLoadingModal();

                try {
                    const analysisPrompt = `Please analyze these symptoms and provide a comprehensive health assessment:
                    
Patient Information:
- Age: ${age}
- Gender: ${gender}
- Symptoms: ${this.symptoms.join(', ')}
- Medical History: ${this.medicalHistory.join(', ') || 'None provided'}

Please provide:
1. Possible conditions (with likelihood)
2. Recommended actions
3. When to seek immediate medical care
4. General health advice

Remember to emphasize that this is general information only and professional medical consultation is recommended.`;

                    const response = await fetch(`${this.apiBaseUrl}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ 
                            message: analysisPrompt,
                            session_id: Date.now().toString()
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    this.hideLoadingModal();
                    if (data.error) {
                        this.showDiagnosisResults(`Error: ${data.error}\n\nPlease try again or consult a healthcare professional.`);
                    } else {
                        this.showDiagnosisResults(data.response || 'No response received from the server.');
                    }
                    
                } catch (error) {
                    console.error('Error analyzing symptoms:', error);
                    this.hideLoadingModal();
                    
                    let errorMessage = '';
                    if (error.message.includes('Failed to fetch')) {
                        errorMessage = `Connection error: Please ensure the server is running at ${this.apiBaseUrl}

Common solutions:
1. Check if the server is running
2. Verify the server URL is correct
3. Check your internet connection
4. Try refreshing the page`;
                    } else {
                        errorMessage = `I apologize, but I'm unable to analyze your symptoms right now due to an error: ${error.message}

Please try again in a moment, or consult with a healthcare professional directly for a proper evaluation of your symptoms.`;
                    }
                    
                    this.showDiagnosisResults(errorMessage);
                }
            }

            showDiagnosisResults(results) {
                const resultsContainer = document.getElementById('diagnosisResults');
                const resultsContent = document.getElementById('resultsContent');
                
                if (!resultsContainer || !resultsContent) {
                    console.error('Results container elements not found');
                    return;
                }
                
                resultsContent.innerHTML = results.replace(/\n/g, '<br>');
                resultsContainer.classList.remove('hidden');
                
                // Scroll to results
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }

            async generateRecommendations() {
                const condition = document.getElementById('conditionSelect').value;
                const severity = document.getElementById('severity').value;
                const age = document.getElementById('prescAge').value;
                const weight = document.getElementById('weight').value;
                const allergies = document.getElementById('allergies').value;
                
                if (!condition || !severity || !age) {
                    alert('Please fill in all required fields (condition, severity, and age).');
                    return;
                }

                this.showLoadingModal();

                try {
                    const recommendationPrompt = `Please provide comprehensive health recommendations for:
                    
Condition: ${condition}
Severity: ${severity}
Patient Age: ${age}
Weight: ${weight || 'Not provided'}
Known Allergies: ${allergies || 'None'}

Please provide:
1. General care recommendations
2. Lifestyle modifications
3. When to seek professional medical care
4. Warning signs to watch for
5. General wellness tips

Focus on safe, evidence-based recommendations and emphasize consulting healthcare professionals for personalized advice.`;

                    const response = await fetch(`${this.apiBaseUrl}/medical_bot`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ question: recommendationPrompt })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    this.hideLoadingModal();
                    this.showPrescriptionResults(data.response_text);
                    
                } catch (error) {
                    console.error('Error generating recommendations:', error);
                    this.hideLoadingModal();
                    
                    const errorMessage = `I apologize, but I'm unable to generate recommendations right now due to a connection error. 

Please try again in a moment, or consult with a healthcare professional directly for personalized medical advice.`;
                    
                    this.showPrescriptionResults(errorMessage);
                }
            }

            showPrescriptionResults(results) {
                const resultsContainer = document.getElementById('prescriptionResults');
                const resultsContent = document.getElementById('prescriptionContent');
                
                resultsContent.innerHTML = results.replace(/\n/g, '<br>');
                resultsContainer.classList.remove('hidden');
                
                // Scroll to results
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }

            showLoadingModal() {
                const modal = document.getElementById('loadingModal');
                if (modal) {
                    modal.classList.remove('hidden');
                }
            }

            hideLoadingModal() {
                const modal = document.getElementById('loadingModal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            }
        }

        // Initialize the chatbot when the page loads
        let chatbot;
        window.addEventListener('DOMContentLoaded', () => {
            chatbot = new MedicalChatbot();
        });

        // Global error handler for unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });

        // Mental Health Tab JavaScript
        function startBreathingExercise() {
            // Implement breathing exercise animation and timer
            alert('Breathing exercise feature coming soon!');
        }

        function startMeditation() {
            // Implement meditation timer and guidance
            alert('Meditation feature coming soon!');
        }

        function openGratitudeJournal() {
            // Implement gratitude journal functionality
            alert('Gratitude journal feature coming soon!');
        }

        // Configuration
        const API_BASE_URL = 'http://127.0.0.1:5000'; // Change this to your server URL

        // Mood Tracker Variables
        let selectedMood = null;
        let moodEntries = JSON.parse(localStorage.getItem('moodEntries') || '[]');

        // Initialize Mood Tracker
        function initMoodTracker() {
            const moodButtons = document.querySelectorAll('.mood-btn');
            const saveMoodBtn = document.getElementById('saveMood');
            const moodNotesTextarea = document.getElementById('moodNotes');
            
            // Mood button selection
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    moodButtons.forEach(btn => btn.classList.remove('selected'));
                    
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    
                    // Store selected mood
                    selectedMood = {
                        value: parseInt(this.dataset.mood),
                        emoji: this.dataset.emoji,
                        label: this.dataset.label
                    };
                    
                    // Show selected mood
                    const selectedMoodDisplay = document.getElementById('selectedMoodDisplay');
                    const selectedMoodText = document.getElementById('selectedMoodText');
                    selectedMoodDisplay.style.display = 'block';
                    selectedMoodText.textContent = `${selectedMood.emoji} ${selectedMood.label}`;
                    
                    // Enable save button
                    updateSaveButton();
                });
            });

            // Save mood entry
            saveMoodBtn.addEventListener('click', function() {
                if (selectedMood) {
                    const entry = {
                        id: Date.now(),
                        mood: selectedMood,
                        notes: moodNotesTextarea.value.trim(),
                        date: new Date().toISOString(),
                        timestamp: Date.now()
                    };
                    
                    // Add to beginning of array (most recent first)
                    moodEntries.unshift(entry);
                    
                    // Keep only last 20 entries
                    if (moodEntries.length > 20) {
                        moodEntries = moodEntries.slice(0, 20);
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('moodEntries', JSON.stringify(moodEntries));
                    
                    // Show success message
                    const successMessage = document.getElementById('moodSuccess');
                    successMessage.textContent = 'Mood entry saved successfully!';
                    successMessage.style.display = 'block';
                    
                    // Hide success message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                    
                    // Reset form
                    resetMoodForm();
                    
                    // Update display
                    displayMoodEntries();
                }
            });

            // Update save button state when notes change
            moodNotesTextarea.addEventListener('input', updateSaveButton);
            
            // Display existing entries
            displayMoodEntries();
        }

        function updateSaveButton() {
            const saveMoodBtn = document.getElementById('saveMood');
            saveMoodBtn.disabled = !selectedMood;
        }

        function resetMoodForm() {
            // Clear mood selection
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            selectedMood = null;
            
            // Hide selected mood display
            document.getElementById('selectedMoodDisplay').style.display = 'none';
            
            // Clear notes
            document.getElementById('moodNotes').value = '';
            
            // Disable save button
            updateSaveButton();
        }

        function displayMoodEntries() {
            const entriesContainer = document.getElementById('moodEntries');
            
            if (!entriesContainer) {
                console.error('Mood entries container not found');
                return;
            }
            
            if (moodEntries.length === 0) {
                entriesContainer.innerHTML = '<div class="no-entries">No mood entries yet. Start tracking your mood above!</div>';
                return;
            }
            
            entriesContainer.innerHTML = moodEntries.map(entry => {
                const date = new Date(entry.date);
                const formattedDate = date.toLocaleDateString() + ' at ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                return `
                    <div class="mood-entry" data-id="${entry.id}">
                        <div class="mood-entry-header">
                            <span class="mood-entry-mood">${entry.mood.emoji} ${entry.mood.label}</span>
                            <div class="mood-entry-controls">
                                <span class="mood-entry-date">${formattedDate}</span>
                                <button class="delete-entry-btn" onclick="deleteMoodEntry(${entry.id})" title="Delete entry">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        ${entry.notes ? `<div class="mood-entry-notes">"${entry.notes}"</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function deleteMoodEntry(entryId) {
            if (confirm('Are you sure you want to delete this mood entry?')) {
                // Remove entry from array
                moodEntries = moodEntries.filter(entry => entry.id !== entryId);
                
                // Update localStorage
                localStorage.setItem('moodEntries', JSON.stringify(moodEntries));
                
                // Update display
                displayMoodEntries();
                
                // Show success message
                const successMessage = document.getElementById('moodSuccess');
                successMessage.textContent = 'Mood entry deleted successfully!';
                successMessage.style.display = 'block';
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 3000);
            }
        }

        // Initialize mood tracker when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initMoodTracker();
        });

        // Utility Functions
        function showLoading(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        function hideLoading(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function hideError(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function showSuccessMessage(elementId, message) {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.style.display = 'block';
            
            // Hide after 3 seconds
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }

        function showResponse(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }

        // Wellness Chat
        document.getElementById('chatForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading('chatLoading');
            hideError('chatError');
            
            const messageText = document.getElementById('messageText').value;
            const sessionType = document.getElementById('sessionType').value;
            
            if (!messageText.trim()) {
                hideLoading('chatLoading');
                showError('chatError', 'Please provide a message.');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/wellness_chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: messageText,
                        type: sessionType
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Show the text response
                    document.getElementById('chatResponseText').textContent = data.response_text;
                    showResponse('chatResponse');
                    
                    // Add audio player if available
                    if (data.audio_available) {
                        const audioContainer = document.createElement('div');
                        audioContainer.className = 'audio-container';
                        
                        const audioBtn = document.createElement('button');
                        audioBtn.className = 'audio-btn';
                        audioBtn.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                        
                        audioBtn.addEventListener('click', () => {
                            playAudio(data.audio_url, audioBtn);
                        });
                        
                        audioContainer.appendChild(audioBtn);
                        document.getElementById('chatResponse').appendChild(audioContainer);
                    }
                } else {
                    showError('chatError', data.error || 'Failed to get wellness response.');
                }
            } catch (error) {
                showError('chatError', 'Connection error. Please check if the server is running.');
            }
            
            hideLoading('chatLoading');
        });

        // Yoga Sequence
        document.getElementById('yogaForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading('yogaLoading');
            hideError('yogaError');
            
            const requestData = {
                need: document.getElementById('yogaNeed').value,
                duration: parseInt(document.getElementById('yogaDuration').value),
                level: document.getElementById('yogaLevel').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/yoga_sequence`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('yogaResponseText').innerText = data.display_text;
                    showResponse('yogaResponse');
                    
                    // Add audio player if available
                    if (data.audio_available) {
                        const audioContainer = document.createElement('div');
                        audioContainer.className = 'audio-container';
                        
                        const audioBtn = document.createElement('button');
                        audioBtn.className = 'audio-btn';
                        audioBtn.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                        
                        audioBtn.addEventListener('click', () => {
                            playAudio(data.audio_url, audioBtn);
                        });
                        
                        audioContainer.appendChild(audioBtn);
                        document.getElementById('yogaResponse').appendChild(audioContainer);
                    }
                } else {
                    showError('yogaError', data.error || 'Failed to generate yoga sequence.');
                }
            } catch (error) {
                showError('yogaError', 'Connection error. Please check if the server is running.');
            }
            
            hideLoading('yogaLoading');
        });

        // Guided Meditation
        document.getElementById('meditationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading('meditationLoading');
            hideError('meditationError');
            
            const requestData = {
                type: document.getElementById('meditationType').value,
                duration: parseInt(document.getElementById('meditationDuration').value)
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/guided_meditation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('meditationResponseText').innerText = data.display_text;
                    showResponse('meditationResponse');
                    
                    // Add audio player if available
                    if (data.audio_available) {
                        const audioContainer = document.createElement('div');
                        audioContainer.className = 'audio-container';
                        
                        const audioBtn = document.createElement('button');
                        audioBtn.className = 'audio-btn';
                        audioBtn.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                        
                        audioBtn.addEventListener('click', () => {
                            playAudio(data.audio_url, audioBtn);
                        });
                        
                        audioContainer.appendChild(audioBtn);
                        document.getElementById('meditationResponse').appendChild(audioContainer);
                    }
                } else {
                    showError('meditationError', data.error || 'Failed to generate meditation.');
                }
            } catch (error) {
                showError('meditationError', 'Connection error. Please check if the server is running.');
            }
            
            hideLoading('meditationLoading');
        });

        // Nutrition Plan
        document.getElementById('nutritionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading('nutritionLoading');
            hideError('nutritionError');
            
            const dietaryPrefs = document.getElementById('dietaryPrefs').value
                .split(',')
                .map(pref => pref.trim())
                .filter(pref => pref.length > 0);
            
            const requestData = {
                goal: document.getElementById('nutritionGoal').value,
                dietary_preferences: dietaryPrefs
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/nutrition_plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('nutritionResponseText').textContent = data.nutrition_plan;
                    showResponse('nutritionResponse');
                } else {
                    showError('nutritionError', data.error || 'Failed to generate nutrition plan.');
                }
            } catch (error) {
                showError('nutritionError', 'Connection error. Please check if the server is running.');
            }
            
            hideLoading('nutritionLoading');
        });

        // Wellness Check
        document.getElementById('wellnessCheckForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            showLoading('wellnessLoading');
            hideError('wellnessError');
            
            const requestData = {
                message: `Please provide wellness support based on these metrics:
                - Mood Level: ${document.getElementById('moodSlider').value}/10
                - Energy Level: ${document.getElementById('energySlider').value}/10
                - Stress Level: ${document.getElementById('stressSlider').value}/10
                
                Please provide:
                1. A brief analysis of these metrics
                2. Personalized wellness recommendations
                3. A suggested next step for improvement`,
                type: 'general'
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/wellness_chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('wellnessResponseText').textContent = data.response_text;
                    document.getElementById('wellnessRecommendation').textContent = 
                        `💡 Recommended next step: ${data.wellness_tip || 'Take a moment to breathe and reflect on your current state.'}`;
                    
                    showResponse('wellnessResponse');
                } else {
                    showError('wellnessError', data.error || 'Failed to process wellness check.');
                }
            } catch (error) {
                showError('wellnessError', 'Connection error. Please check if the server is running.');
            }
            
            hideLoading('wellnessLoading');
        });

        // Slider Updates
        function updateSliderValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);
            
            slider.addEventListener('input', function() {
                valueDisplay.textContent = `${this.value}/10`;
            });
        }

        updateSliderValue('moodSlider', 'moodValue');
        updateSliderValue('energySlider', 'energyValue');
        updateSliderValue('stressSlider', 'stressValue');

        // Daily Tip Function
        function updateDailyTip(tip) {
            const dailyTipElement = document.getElementById('dailyTip');
            dailyTipElement.querySelector('p').textContent = tip;
        }

        // Load a default tip on page load
        window.addEventListener('load', function() {
            const defaultTips = [
                "Take three deep breaths whenever you feel overwhelmed. You are stronger than you know.",
                "Remember: Progress, not perfection. Every small step counts on your wellness journey.",
                "Your feelings are valid. It's okay to not be okay sometimes.",
                "Gentle movement can shift your energy. Even a short walk can make a difference."
            ];
            
            const randomTip = defaultTips[Math.floor(Math.random() * defaultTips.length)];
            updateDailyTip(randomTip);
        });
    
        // Initialize components when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const tabManager = new TabManager();
            const formManager = new FormManager();
            tabManager.loadTabState();
            
            // Initialize mood tracker
            initMoodTracker();
            
            // Initialize sliders
            updateSliderValue('moodSlider', 'moodValue');
            updateSliderValue('energySlider', 'energyValue');
            updateSliderValue('stressSlider', 'stressValue');
            
            // Load default tip
            const defaultTips = [
                "Take three deep breaths whenever you feel overwhelmed. You are stronger than you know.",
                "Remember: Progress, not perfection. Every small step counts on your wellness journey.",
                "Your feelings are valid. It's okay to not be okay sometimes.",
                "Gentle movement can shift your energy. Even a short walk can make a difference."
            ];
            
            const randomTip = defaultTips[Math.floor(Math.random() * defaultTips.length)];
            updateDailyTip(randomTip);
        });

        function playAudio(audioUrl, buttonElement) {
            // Create audio element if it doesn't exist
            if (!window.currentAudio) {
                window.currentAudio = new Audio();
            }

            // If already playing this audio, stop it
            if (window.currentAudio.src === audioUrl && !window.currentAudio.paused) {
                window.currentAudio.pause();
                window.currentAudio.currentTime = 0;
                buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                buttonElement.classList.remove('playing');
                return;
            }

            // Set up new audio
            window.currentAudio.src = audioUrl;
            window.currentAudio.volume = 1.0; // Set maximum volume

            // Add error handling
            window.currentAudio.onerror = (error) => {
                console.error('Audio playback failed:', error);
                buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Playback Failed';
                buttonElement.classList.remove('playing');
                
                // Try to reload the audio after a short delay
                setTimeout(() => {
                    window.currentAudio.load();
                    buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                }, 3000);
            };

            // Add loading state
            buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            buttonElement.disabled = true;

            // Play the audio with proper error handling
            const playPromise = window.currentAudio.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        buttonElement.innerHTML = '<i class="fas fa-stop"></i> Stop Audio';
                        buttonElement.classList.add('playing');
                        buttonElement.disabled = false;
                    })
                    .catch(error => {
                        console.error('Audio playback failed:', error);
                        buttonElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Playback Failed';
                        buttonElement.classList.remove('playing');
                        buttonElement.disabled = false;

                        // Try to reload the audio after a short delay
                        setTimeout(() => {
                            window.currentAudio.load();
                            buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                        }, 3000);
                    });
            }

            // Handle audio end
            window.currentAudio.onended = () => {
                buttonElement.innerHTML = '<i class="fas fa-play"></i> Play Audio';
                buttonElement.classList.remove('playing');
                buttonElement.disabled = false;
            };
        }
    </script>
</body>
</html>